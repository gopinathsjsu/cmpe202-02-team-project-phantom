{
  "info": {
    "name": "Orchestrator APIs",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "_postman_id": "f2a3e7d2-0c8d-4d7f-a6c1-3aa5f8b1d001"
  },
  "item": [
    {
      "name": "Users",
      "item": [
        {
          "name": "Signup",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "url": {
              "raw": "{{base_url}}/api/users/signup",
              "host": ["{{base_url}}"],
              "path": ["api", "users", "signup"]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"user_name\": \"John Doe\",\n  \"email\": \"john.doe@sjsu.edu\",\n  \"password\": \"secret123\"\n}"
            }
          },
          "response": []
        },
        {
          "name": "Login",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "url": {
              "raw": "{{base_url}}/api/users/login",
              "host": ["{{base_url}}"],
              "path": ["api", "users", "login"]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"john.doe@sjsu.edu\",\n  \"password\": \"secret123\"\n}"
            }
          },
          "response": []
        },
        {
          "name": "Refresh Token",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "url": {
              "raw": "{{base_url}}/api/users/refresh",
              "host": ["{{base_url}}"],
              "path": ["api", "users", "refresh"]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"refresh_token\": \"{{refresh_token}}\"\n}"
            }
          },
          "response": []
        },
        {
          "name": "Get Profile",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Authorization", "value": "Bearer {{access_token}}" }
            ],
            "url": {
              "raw": "{{base_url}}/api/users/profile",
              "host": ["{{base_url}}"],
              "path": ["api", "users", "profile"]
            }
          },
          "response": []
        },
        {
          "name": "Search Users",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Authorization", "value": "Bearer {{access_token}}" }
            ],
            "url": {
              "raw": "{{base_url}}/api/users/search?q=john&page=1&limit=20",
              "host": ["{{base_url}}"],
              "path": ["api", "users", "search"],
              "query": [
                { "key": "q", "value": "john", "description": "Search query (required, minimum 1 character)" },
                { "key": "page", "value": "1", "description": "Page number (default: 1)" },
                { "key": "limit", "value": "20", "description": "Results per page (default: 20, max: 100)" }
              ]
            },
            "description": "Search users by username prefix (case-insensitive). Returns user_id and user_name. Excludes the authenticated user from results. Supports pagination."
          },
          "response": []
        }
      ]
    },
    {
      "name": "Listings",
      "item": [
        {
          "name": "Get All Listings",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Authorization", "value": "Bearer {{access_token}}" }
            ],
            "url": {
              "raw": "{{base_url}}/api/listings/?limit=20&offset=0",
              "host": ["{{base_url}}"],
              "path": ["api", "listings", ""],
              "query": [
                { "key": "limit", "value": "20", "disabled": true },
                { "key": "offset", "value": "0", "disabled": true },
                { "key": "sort", "value": "", "disabled": true },
                { "key": "keywords", "value": "", "disabled": true },
                { "key": "category", "value": "", "disabled": true },
                { "key": "status", "value": "", "disabled": true },
                { "key": "min_price", "value": "", "disabled": true },
                { "key": "max_price", "value": "", "disabled": true }
              ]
            }
          },
          "response": []
        },
        {
          "name": "Get Listing by ID",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Authorization", "value": "Bearer {{access_token}}" }
            ],
            "url": {
              "raw": "{{base_url}}/api/listings/{{listing_id}}",
              "host": ["{{base_url}}"],
              "path": ["api", "listings", "{{listing_id}}"]
            }
          },
          "response": []
        },
        {
          "name": "Create Listing",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Authorization", "value": "Bearer {{access_token}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "url": {
              "raw": "{{base_url}}/api/listings/create",
              "host": ["{{base_url}}"],
              "path": ["api", "listings", "create"]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"title\": \"Vintage Chair\",\n  \"price\": 150,\n  \"category\": \"OTHER\",\n  \"description\": \"Solid oak, lightly used, perfect for dining rooms.\"\n}"
            }
          },
          "response": []
        },
        {
          "name": "Update Listing",
          "request": {
            "method": "PATCH",
            "header": [
              { "key": "Authorization", "value": "Bearer {{access_token}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "url": {
              "raw": "{{base_url}}/api/listings/update/{{listing_id}}",
              "host": ["{{base_url}}"],
              "path": ["api", "listings", "update", "{{listing_id}}"]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"title\": \"Updated Title\",\n  \"price\": 200,\n  \"status\": \"AVAILABLE\"\n}"
            },
            "description": "Update a listing. Regular users can only update their own listings. Admins can update any listing, including changing the status of listings created by other users."
          },
          "response": []
        },
        {
          "name": "Delete Listing",
          "request": {
            "method": "DELETE",
            "header": [
              { "key": "Authorization", "value": "Bearer {{access_token}}" }
            ],
            "url": {
              "raw": "{{base_url}}/api/listings/delete/{{listing_id}}?hard=false",
              "host": ["{{base_url}}"],
              "path": ["api", "listings", "delete", "{{listing_id}}"],
              "query": [
                { "key": "hard", "value": "false", "disabled": true }
              ]
            }
          },
          "response": []
        },
        {
          "name": "Get User Listings",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Authorization", "value": "Bearer {{access_token}}" }
            ],
            "url": {
              "raw": "{{base_url}}/api/listings/user-lists/",
              "host": ["{{base_url}}"],
              "path": ["api", "listings", "user-lists", ""]
            }
          },
          "response": []
        },
        {
          "name": "Get Listings by User ID (Admin Only)",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Authorization", "value": "Bearer {{access_token}}" }
            ],
            "url": {
              "raw": "{{base_url}}/api/listings/by-user-id?user_id={{target_user_id}}",
              "host": ["{{base_url}}"],
              "path": ["api", "listings", "by-user-id"],
              "query": [
                { "key": "user_id", "value": "{{target_user_id}}", "description": "UUID of the user whose listings to fetch (required)" }
              ]
            },
            "description": "Admin-only endpoint to fetch all listings created by a specific user. Returns the complete listing model for each listing."
          },
          "response": []
        },
        {
          "name": "Upload Media",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Authorization", "value": "Bearer {{access_token}}" }
            ],
            "url": {
              "raw": "{{base_url}}/api/listings/upload?listing_id={{listing_id}}",
              "host": ["{{base_url}}"],
              "path": ["api", "listings", "upload"],
              "query": [
                { "key": "listing_id", "value": "{{listing_id}}", "disabled": true, "description": "Optional: If provided, permanent URLs will be automatically saved to this listing" }
              ]
            },
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "media",
                  "type": "file",
                  "src": [],
                  "description": "Upload one or more files. The response will contain SAS URLs for direct upload to Azure Blob Storage."
                }
              ]
            },
            "description": "Upload file metadata to generate SAS URLs for direct blob storage upload. If listing_id is provided, permanent URLs will be automatically saved to that listing."
          },
          "response": []
        },
        {
          "name": "Upload File to SAS URL",
          "request": {
            "method": "PUT",
            "header": [
              { "key": "x-ms-blob-type", "value": "BlockBlob", "description": "Required for Azure Blob Storage" },
              { "key": "Content-Type", "value": "{{file_content_type}}", "description": "Set to the appropriate content type (e.g., image/jpeg, image/png)" }
            ],
            "body": {
              "mode": "file",
              "file": {
                "src": ""
              },
              "options": {
                "raw": {
                  "language": "text"
                }
              }
            },
            "url": {
              "raw": "{{sas_url}}",
              "host": ["{{sas_url}}"],
              "description": "Use the sas_url from the Upload Media response. Example: https://markeplace.blob.core.windows.net/listingmedia/filename.jpg?se=...&sig=..."
            },
            "description": "Upload the actual file to Azure Blob Storage using the SAS URL from the Upload Media response. This is a direct PUT request to Azure, not to the orchestrator.\n\nCURL Example:\ncurl -X PUT \"{{sas_url}}\" \\\n  -H \"x-ms-blob-type: BlockBlob\" \\\n  -H \"Content-Type: image/jpeg\" \\\n  --data-binary @/path/to/your/file.jpg"
          },
          "response": []
        },
        {
          "name": "Add Media URL",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Authorization", "value": "Bearer {{access_token}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "url": {
              "raw": "{{base_url}}/api/listings/add-media-url/{{listing_id}}",
              "host": ["{{base_url}}"],
              "path": ["api", "listings", "add-media-url", "{{listing_id}}"]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"media_urls\": [\n    \"https://example.com/image1.jpg\",\n    \"https://example.com/image2.jpg\"\n  ]\n}"
            }
          },
          "response": []
        },
        {
          "name": "Chat Search",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Authorization", "value": "Bearer {{access_token}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "url": {
              "raw": "{{base_url}}/api/listings/chatsearch",
              "host": ["{{base_url}}"],
              "path": ["api", "listings", "chatsearch"]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"query\": \"Any routers?\"\n}"
            }
          },
          "response": []
        },
        {
          "name": "Get Flagged Listings (Admin Only)",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Authorization", "value": "Bearer {{access_token}}" }
            ],
            "url": {
              "raw": "{{base_url}}/api/listings/flagged?status=",
              "host": ["{{base_url}}"],
              "path": ["api", "listings", "flagged"],
              "query": [
                { "key": "status", "value": "", "disabled": true, "description": "Optional: Filter by flag status (OPEN, UNDER_REVIEW, RESOLVED, DISMISSED)" }
              ]
            },
            "description": "Admin-only endpoint to fetch all flagged listings. Optionally filter by flag status."
          },
          "response": []
        }
      ]
    }
  ],
  "event": [],
  "variable": [
    { "key": "base_url", "value": "http://localhost:8080" },
    { "key": "access_token", "value": "" },
    { "key": "refresh_token", "value": "" },
    { "key": "listing_id", "value": "" },
    { "key": "target_user_id", "value": "", "description": "UUID of target user for admin endpoints" },
    { "key": "sas_url", "value": "", "description": "SAS URL from Upload Media response" },
    { "key": "file_content_type", "value": "image/jpeg", "description": "Content type of the file being uploaded (e.g., image/jpeg, image/png, image/gif)" }
  ]
}


